# HTTP请求

>介绍 HTTP 之前，我们需要了解一些前置知识。

## IP 协议（Internet Protocol）

IP 协议是 TCP/IP 协议族中的核心协议，它定义了计算机之间如何通信以及数据如何在网络中传输。IP 协议负责将数据从源地址传送到目的地址。

IP 协议的主要功能有：

1. 寻址：IP 协议采用 32 位地址，每个 IP 地址都对应唯一的网络设备。
2. 路由：IP 协议使用路由表来决定数据包的路径。
3. 转发：当数据包到达目的地址时，IP 协议会检查目的地址是否在本地网络，如果在本地网络，则直接传送，否则需要通过路由表来选择下一跳路由器，并将数据包传送到下一跳路由器。
4. 分片：当数据包的长度超过网络传输的最大包长时，IP 协议会将数据包分割成多个小包，并通过 IP 头部的分片字段来标识。
5. 错误检测：IP 协议提供检错机制，检测数据包是否被篡改。


## TCP 协议（Transmission Control Protocol）

TCP 协议是一种面向连接的、可靠的、基于字节流的传输层协议。它负责建立连接、数据传输、保证数据完整性、保证数据顺序、处理丢包重传等。

TCP 协议的主要功能有：

1. 建立连接：TCP 协议采用三次握手建立连接，即客户端发送 SYN 报文，服务器收到后返回 SYN/ACK 报文，客户端再次发送 ACK 报文，连接建立。
2. 数据传输：TCP 协议采用可靠的字节流传输，即 TCP 协议会将数据分割成 TCP 包，并通过序号和确认号来保证数据传输的完整性。
3. 保证数据顺序：TCP 协议保证数据包按顺序到达目的地址。


## DNS 协议（Domain Name System）

DNS 协议是用于域名解析的协议，它将域名转换成 IP 地址。

DNS 协议的主要功能有：

1. 域名解析：DNS 协议将域名转换成 IP 地址，使得用户可以方便地访问互联网资源。
2. 负载均衡：DNS 协议可以将域名请求转发到多个服务器，实现负载均衡。

DNS 的优先级：

1. 本地 DNS 服务器：如果本地 DNS 服务器中有域名的解析记录，则直接返回解析结果。
2. 主 DNS 服务器：如果本地 DNS 服务器中没有域名的解析记录，则向主 DNS 服务器请求解析结果。
3. 缓存 DNS 服务器：如果主 DNS 服务器也没有域名的解析记录，则向缓存 DNS 服务器请求解析结果。
4. 根 DNS 服务器：如果缓存 DNS 服务器也没有域名的解析记录，则向根 DNS 服务器请求解析结果。

前置知识介绍完毕，下面我们来看一下 HTTP 协议。

## HTTP 协议（Hypertext Transfer Protocol）

HTTP 协议是用于从 Web 服务器传输超文本到本地浏览器的协议。它是一个基于请求-响应模型的协议，由请求消息和响应消息构成。

HTTP 协议的主要功能有：

1. 客户机-服务器模型：HTTP 协议是客户机-服务器模型的基础协议。
2. 无状态：HTTP 协议是无状态协议，即服务器不会保存关于客户的任何信息。


HTTP 请求分为三大部分：

1. 请求行：包括方法、URL、HTTP 版本。

```http
GET baidu.com/index.html HTTP/1.1
```


2. 请求头

```http
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, sdch, br
Accept-Language: zh-CN,zh;q=0.8
``` 

3. 请求体
```
search=hello
```

响应也是差不多的格式，但是响应头会包含状态码、服务器信息等。

```http
HTTP/1.1 200 OK
Server: nginx/1.10.1
```

那么发起 HTTP 后，只有一个域名是怎么知道目标服务器的地址呢，这就要用到上述的 IP 协议了。

但是 IP 是数字，如何把域名转换成 IP 呢？这就要用到 DNS 了, DNS 协议将域名转换成 IP 地址，使得用户可以方便地访问目标服务器。

HTTP 协议的请求流程：

1. 客户端向 DNS 服务器请求域名对应的 IP 地址。
2. DNS 服务器解析域名，返回 IP 地址和端口号。
3. 客户端向目标服务器发起 TCP 三次握手建立连接。
4. 客户端和服务器传输数据。
5. 四次挥手断开 TCP 连接。

在 HTTP/1.1 及更高版本中，可以通过 Keep-Alive 复用连接，减少 TCP 连接的建立和断开。


